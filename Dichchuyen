local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")

-- --- C·∫§U H√åNH ---
local CONFIG = {
    CharacterName = "Kamen Rider Diend",
    AttackDelay = 0.2,
    TeleportInterval = 3,
}

-- --- BI·∫æN TR·∫†NG TH√ÅI ---
local selectedTarget = nil
local isAutoFarmKill = false
local lastTeleportTime = 0
local hasSelectedCharacter = false
local lastHealth = 100

-- --- T·∫†O GUI HI·ªÜN ƒê·∫†I ---
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ModernAutoFarmGUI"
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.ResetOnSpawn = false

-- N√∫t Toggle GUI (c√≥ th·ªÉ di chuy·ªÉn) - M√ÄU V√ÄNG C√ÅT V·ªöI ·∫¢NH
local ToggleBtn = Instance.new("ImageButton")
ToggleBtn.Parent = ScreenGui
ToggleBtn.BackgroundColor3 = Color3.fromRGB(218, 165, 32) -- M√†u v√†ng c√°t
ToggleBtn.Position = UDim2.new(0.02, 0, 0.3, 0)
ToggleBtn.Size = UDim2.new(0, 70, 0, 70)
ToggleBtn.Image = "rbxassetid://7965269366" -- ID ·∫£nh c·ªßa b·∫°n
ToggleBtn.ScaleType = Enum.ScaleType.Fit
ToggleBtn.Active = true
ToggleBtn.Draggable = true

local ToggleCorner = Instance.new("UICorner")
ToggleCorner.CornerRadius = UDim.new(0, 15)
ToggleCorner.Parent = ToggleBtn

local ToggleStroke = Instance.new("UIStroke")
ToggleStroke.Color = Color3.fromRGB(255, 215, 0) -- Vi·ªÅn v√†ng s√°ng
ToggleStroke.Thickness = 4
ToggleStroke.Parent = ToggleBtn

-- Th√™m hi·ªáu ·ª©ng shadow cho n√∫t
local ToggleShadow = Instance.new("ImageLabel")
ToggleShadow.Parent = ToggleBtn
ToggleShadow.BackgroundTransparency = 1
ToggleShadow.Position = UDim2.new(0, -5, 0, -5)
ToggleShadow.Size = UDim2.new(1, 10, 1, 10)
ToggleShadow.Image = "rbxasset://textures/ui/GuiImagePlaceholder.png"
ToggleShadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
ToggleShadow.ImageTransparency = 0.7
ToggleShadow.ZIndex = -1

-- Main Frame (c√≥ th·ªÉ k√©o to√†n m√†n h√¨nh)
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
MainFrame.Position = UDim2.new(0.5, -180, 0.5, -200)
MainFrame.Size = UDim2.new(0, 360, 0, 400)
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Visible = false

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 15)
MainCorner.Parent = MainFrame

local MainStroke = Instance.new("UIStroke")
MainStroke.Color = Color3.fromRGB(255, 50, 50)
MainStroke.Thickness = 3
MainStroke.Parent = MainFrame

-- Header
local Header = Instance.new("TextLabel")
Header.Parent = MainFrame
Header.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
Header.Size = UDim2.new(1, 0, 0, 50)
Header.Font = Enum.Font.GothamBold
Header.Text = "‚öîÔ∏è AUTO FARM KILL"
Header.TextColor3 = Color3.fromRGB(255, 255, 255)
Header.TextSize = 20

local HeaderCorner = Instance.new("UICorner")
HeaderCorner.CornerRadius = UDim.new(0, 15)
HeaderCorner.Parent = Header

-- Close Button
local CloseBtn = Instance.new("TextButton")
CloseBtn.Parent = Header
CloseBtn.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
CloseBtn.Position = UDim2.new(1, -45, 0, 5)
CloseBtn.Size = UDim2.new(0, 40, 0, 40)
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.Text = "‚úï"
CloseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseBtn.TextSize = 24

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 10)
CloseCorner.Parent = CloseBtn

-- Label Target
local TargetLabel = Instance.new("TextLabel")
TargetLabel.Parent = MainFrame
TargetLabel.BackgroundTransparency = 1
TargetLabel.Position = UDim2.new(0, 15, 0, 60)
TargetLabel.Size = UDim2.new(1, -30, 0, 25)
TargetLabel.Font = Enum.Font.GothamBold
TargetLabel.Text = "üéØ Ch·ªçn m·ª•c ti√™u:"
TargetLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
TargetLabel.TextSize = 16
TargetLabel.TextXAlignment = Enum.TextXAlignment.Left

-- ScrollFrame cho danh s√°ch ng∆∞·ªùi ch∆°i
local ScrollFrame = Instance.new("ScrollingFrame")
ScrollFrame.Parent = MainFrame
ScrollFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
ScrollFrame.BorderSizePixel = 0
ScrollFrame.Position = UDim2.new(0, 15, 0, 90)
ScrollFrame.Size = UDim2.new(1, -30, 0, 180)
ScrollFrame.ScrollBarThickness = 6
ScrollFrame.ScrollBarImageColor3 = Color3.fromRGB(255, 50, 50)

local ScrollCorner = Instance.new("UICorner")
ScrollCorner.CornerRadius = UDim.new(0, 10)
ScrollCorner.Parent = ScrollFrame

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Parent = ScrollFrame
UIListLayout.Padding = UDim.new(0, 5)
UIListLayout.SortOrder = Enum.SortOrder.Name

-- Status Label
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Parent = MainFrame
StatusLabel.BackgroundTransparency = 1
StatusLabel.Position = UDim2.new(0, 15, 0, 280)
StatusLabel.Size = UDim2.new(1, -30, 0, 25)
StatusLabel.Font = Enum.Font.GothamBold
StatusLabel.Text = "‚ö° Tr·∫°ng th√°i: Ch·ªù..."
StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 100)
StatusLabel.TextSize = 14
StatusLabel.TextXAlignment = Enum.TextXAlignment.Left

-- Refresh Button
local RefreshBtn = Instance.new("TextButton")
RefreshBtn.Parent = MainFrame
RefreshBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
RefreshBtn.Position = UDim2.new(0, 15, 0, 315)
RefreshBtn.Size = UDim2.new(0.48, -10, 0, 40)
RefreshBtn.Font = Enum.Font.GothamBold
RefreshBtn.Text = "üîÑ Refresh"
RefreshBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
RefreshBtn.TextSize = 16

local RefreshCorner = Instance.new("UICorner")
RefreshCorner.CornerRadius = UDim.new(0, 10)
RefreshCorner.Parent = RefreshBtn

-- Auto Farm Kill Button
local AutoBtn = Instance.new("TextButton")
AutoBtn.Parent = MainFrame
AutoBtn.BackgroundColor3 = Color3.fromRGB(70, 70, 75)
AutoBtn.Position = UDim2.new(0.52, 0, 0, 315)
AutoBtn.Size = UDim2.new(0.48, -15, 0, 40)
AutoBtn.Font = Enum.Font.GothamBold
AutoBtn.Text = "‚öîÔ∏è Auto Farm Kill"
AutoBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
AutoBtn.TextSize = 14

local AutoCorner = Instance.new("UICorner")
AutoCorner.CornerRadius = UDim.new(0, 10)
AutoCorner.Parent = AutoBtn

-- Credit
local Credit = Instance.new("TextLabel")
Credit.Parent = MainFrame
Credit.BackgroundTransparency = 1
Credit.Position = UDim2.new(0, 0, 1, -25)
Credit.Size = UDim2.new(1, 0, 0, 20)
Credit.Font = Enum.Font.GothamBold
Credit.Text = "Made for Mobile üì±"
Credit.TextColor3 = Color3.fromRGB(120, 120, 125)
Credit.TextSize = 12

-- --- H√ÄM CH·ªåN T∆Ø·ªöNG ---
local function SelectCharacter()
    local success = pcall(function()
        local args = {
            "Select",
            CONFIG.CharacterName,
            LocalPlayer.PlayerGui:WaitForChild("Menu")
        }
        LocalPlayer.PlayerGui:WaitForChild("Menu"):WaitForChild("Frame"):WaitForChild("LocalScript"):WaitForChild("RemoteEvent"):FireServer(unpack(args))
    end)
    
    if success then
        hasSelectedCharacter = true
        print("‚úÖ ƒê√£ ch·ªçn t∆∞·ªõng: " .. CONFIG.CharacterName)
        StatusLabel.Text = "‚úÖ ƒê√£ ch·ªçn t∆∞·ªõng!"
        StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        task.wait(1)
    else
        print("‚ùå L·ªói khi ch·ªçn t∆∞·ªõng!")
    end
end

-- --- H√ÄM T√åM REMOTE ---
local function GetCharacterRemote()
    local tool = LocalPlayer.Backpack:FindFirstChild(CONFIG.CharacterName) or LocalPlayer.Character:FindFirstChild(CONFIG.CharacterName)
    if tool then
        return tool:FindFirstChild("Remote")
    end
    return nil
end

-- --- H√ÄM T·∫†O DANH S√ÅCH NG∆Ø·ªúI CH∆†I ---
local playerButtons = {}

local function CreatePlayerList()
    -- X√≥a danh s√°ch c≈©
    for _, btn in ipairs(playerButtons) do
        btn:Destroy()
    end
    playerButtons = {}

    local totalHeight = 5
    
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local button = Instance.new("TextButton")
            button.Parent = ScrollFrame
            button.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
            button.Size = UDim2.new(1, -10, 0, 35)
            button.Font = Enum.Font.GothamBold
            button.Text = "üë§ " .. player.Name
            button.TextColor3 = Color3.fromRGB(255, 255, 255)
            button.TextSize = 14
            button.TextXAlignment = Enum.TextXAlignment.Left
            button.TextTruncate = Enum.TextTruncate.AtEnd
            
            -- Padding cho text
            local padding = Instance.new("UIPadding")
            padding.PaddingLeft = UDim.new(0, 10)
            padding.Parent = button
            
            local corner = Instance.new("UICorner")
            corner.CornerRadius = UDim.new(0, 8)
            corner.Parent = button
            
            button.MouseButton1Click:Connect(function()
                selectedTarget = player
                
                -- Reset m√†u t·∫•t c·∫£ n√∫t
                for _, btn in ipairs(playerButtons) do
                    btn.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
                    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
                end
                
                -- Highlight n√∫t ƒë∆∞·ª£c ch·ªçn
                button.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
                button.TextColor3 = Color3.fromRGB(255, 255, 255)
                
                StatusLabel.Text = "üéØ M·ª•c ti√™u: " .. player.Name
                StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
            end)
            
            table.insert(playerButtons, button)
            totalHeight = totalHeight + 40
        end
    end
    
    ScrollFrame.CanvasSize = UDim2.new(0, 0, 0, totalHeight)
end

-- --- H√ÄM TELEPORT ---
local function TeleportToTarget()
    if not selectedTarget or not selectedTarget.Character then return end
    
    local targetRoot = selectedTarget.Character:FindFirstChild("HumanoidRootPart")
    local myChar = LocalPlayer.Character
    local myRoot = myChar and myChar:FindFirstChild("HumanoidRootPart")
    
    if targetRoot and myRoot then
        myRoot.CFrame = targetRoot.CFrame * CFrame.new(0, 3, -5)
        lastTeleportTime = tick()
    end
end

-- --- H√ÄM T·∫§N C√îNG ---
local function AttackTarget()
    local remote = GetCharacterRemote()
    if remote then
        remote:FireServer("Attack")
    end
end

-- --- THEO D√ïI RESPAWN ---
local function SetupCharacterMonitoring()
    LocalPlayer.CharacterAdded:Connect(function(character)
        -- ƒê·ª£i character load xong
        task.wait(0.5)
        
        -- N·∫øu auto ƒëang b·∫≠t v√† ch∆∞a ch·ªçn t∆∞·ªõng sau khi respawn
        if isAutoFarmKill and not hasSelectedCharacter then
            StatusLabel.Text = "üîÑ ƒêang ch·ªçn t∆∞·ªõng..."
            StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 100)
            
            task.wait(1) -- ƒê·ª£i menu load
            SelectCharacter()
            
            task.wait(1.5)
            if isAutoFarmKill and selectedTarget then
                StatusLabel.Text = "‚öîÔ∏è ƒêang farm: " .. selectedTarget.Name
                StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
            end
        end
        
        -- Theo d√µi m√°u ƒë·ªÉ ph√°t hi·ªán ch·∫øt
        local humanoid = character:WaitForChild("Humanoid")
        lastHealth = humanoid.Health
        
        humanoid.Died:Connect(function()
            hasSelectedCharacter = false -- Reset flag khi ch·∫øt
            print("üíÄ Nh√¢n v·∫≠t ƒë√£ ch·∫øt, s·∫Ω ch·ªçn l·∫°i t∆∞·ªõng khi respawn")
        end)
    end)
end

-- --- HI·ªÜU ·ª®NG N√öT TOGGLE ---
local function AddButtonAnimation()
    local originalSize = ToggleBtn.Size
    local hoverSize = UDim2.new(0, 75, 0, 75)
    
    ToggleBtn.MouseEnter:Connect(function()
        ToggleBtn:TweenSize(hoverSize, Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.2, true)
        ToggleStroke.Thickness = 5
    end)
    
    ToggleBtn.MouseLeave:Connect(function()
        ToggleBtn:TweenSize(originalSize, Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.2, true)
        ToggleStroke.Thickness = 4
    end)
end

-- --- LOGIC N√öT B·∫§M ---
ToggleBtn.MouseButton1Click:Connect(function()
    MainFrame.Visible = not MainFrame.Visible
    
    -- Hi·ªáu ·ª©ng nh·∫•n
    ToggleBtn:TweenSize(UDim2.new(0, 65, 0, 65), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.1, true)
    task.wait(0.1)
    ToggleBtn:TweenSize(UDim2.new(0, 70, 0, 70), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.1, true)
end)

CloseBtn.MouseButton1Click:Connect(function()
    MainFrame.Visible = false
end)

RefreshBtn.MouseButton1Click:Connect(function()
    CreatePlayerList()
    StatusLabel.Text = "‚úÖ ƒê√£ l√†m m·ªõi danh s√°ch!"
    StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
    
    task.wait(2)
    if not isAutoFarmKill then
        StatusLabel.Text = "‚ö° Tr·∫°ng th√°i: Ch·ªù..."
        StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 100)
    end
end)

AutoBtn.MouseButton1Click:Connect(function()
    if not selectedTarget then
        StatusLabel.Text = "‚ö†Ô∏è Ch∆∞a ch·ªçn m·ª•c ti√™u!"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        return
    end
    
    isAutoFarmKill = not isAutoFarmKill
    
    if isAutoFarmKill then
        AutoBtn.Text = "üõë D·ª´ng Farm"
        AutoBtn.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
        
        -- Ch·ªçn t∆∞·ªõng n·∫øu ch∆∞a ch·ªçn
        if not hasSelectedCharacter then
            StatusLabel.Text = "üîÑ ƒêang ch·ªçn t∆∞·ªõng..."
            StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 100)
            SelectCharacter()
            task.wait(1)
        end
        
        StatusLabel.Text = "‚öîÔ∏è ƒêang farm: " .. selectedTarget.Name
        StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        
        -- Teleport ngay l·∫≠p t·ª©c
        TeleportToTarget()
    else
        AutoBtn.Text = "‚öîÔ∏è Auto Farm Kill"
        AutoBtn.BackgroundColor3 = Color3.fromRGB(70, 70, 75)
        StatusLabel.Text = "‚è∏Ô∏è ƒê√£ d·ª´ng farm"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 100)
    end
end)

-- --- V√íNG L·∫∂P T·∫§N C√îNG ---
task.spawn(function()
    while true do
        if isAutoFarmKill and selectedTarget then
            -- Ki·ªÉm tra m·ª•c ti√™u c√≤n s·ªëng kh√¥ng
            if selectedTarget.Character and selectedTarget.Character:FindFirstChild("Humanoid") and selectedTarget.Character.Humanoid.Health > 0 then
                AttackTarget()
                
                -- Teleport m·ªói 3 gi√¢y
                if tick() - lastTeleportTime >= CONFIG.TeleportInterval then
                    TeleportToTarget()
                end
            else
                StatusLabel.Text = "üíÄ M·ª•c ti√™u ƒë√£ ch·∫øt!"
                StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
            end
        end
        task.wait(CONFIG.AttackDelay)
    end
end)

-- --- KH·ªûI T·∫†O ---
AddButtonAnimation()
SetupCharacterMonitoring()
CreatePlayerList()

-- Auto refresh khi c√≥ ng∆∞·ªùi v√†o/ra
Players.PlayerAdded:Connect(function()
    task.wait(1)
    CreatePlayerList()
end)

Players.PlayerRemoving:Connect(function(player)
    if selectedTarget == player then
        selectedTarget = nil
        isAutoFarmKill = false
        AutoBtn.Text = "‚öîÔ∏è Auto Farm Kill"
        AutoBtn.BackgroundColor3 = Color3.fromRGB(70, 70, 75)
        StatusLabel.Text = "‚ö†Ô∏è M·ª•c ti√™u ƒë√£ tho√°t!"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
    end
    CreatePlayerList()
end)
