local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local Camera = Workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- --- Cáº¤U HÃŒNH Máº¶C Äá»ŠNH ---
local SETTINGS = {
    AimbotEnabled = true,
    TeamCheck = true,
    AimPart = "Head",
    FOVSize = 50,
    Smoothness = 0.5,
    DistanceMultiplier = 0.03,  -- Há»† Sá» BÃ™ KHOáº¢NG CÃCH
    VisibleCheck = true,
    PredictionEnabled = true     -- Dá»° ÄOÃN DI CHUYá»‚N
}

-- --- BIáº¾N Há»† THá»NG ---
local CurrentTarget = nil

-- --- Táº O GUI ---
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "GeminiAimGUI"
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.ResetOnSpawn = false

-- 1. NÃšT Báº¬T Táº®T (DRAGGABLE)
local ToggleButton = Instance.new("TextButton")
ToggleButton.Name = "ToggleAimMenu"
ToggleButton.Parent = ScreenGui
ToggleButton.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
ToggleButton.Position = UDim2.new(0.1, 0, 0.3, 0)
ToggleButton.Size = UDim2.new(0, 50, 0, 50)
ToggleButton.Font = Enum.Font.GothamBold
ToggleButton.Text = "AIM"
ToggleButton.TextColor3 = Color3.new(1, 1, 1)
ToggleButton.TextSize = 14
ToggleButton.AutoButtonColor = true

local ToggleCorner = Instance.new("UICorner")
ToggleCorner.CornerRadius = UDim.new(1, 0)
ToggleCorner.Parent = ToggleButton

local ToggleStroke = Instance.new("UIStroke")
ToggleStroke.Parent = ToggleButton
ToggleStroke.Color = Color3.new(1, 1, 1)
ToggleStroke.Thickness = 2

-- HÃ m di chuyá»ƒn nÃºt
local function MakeDraggable(guiObject)
    local dragging, dragInput, dragStart, startPos
    guiObject.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = guiObject.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    guiObject.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            guiObject.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
end
MakeDraggable(ToggleButton)

-- 2. MENU CHÃNH
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
MainFrame.Position = UDim2.new(0.5, -140, 0.5, -180)
MainFrame.Size = UDim2.new(0, 280, 0, 400)
MainFrame.Visible = false
MainFrame.BorderSizePixel = 0

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 15)
MainCorner.Parent = MainFrame

local Title = Instance.new("TextLabel")
Title.Parent = MainFrame
Title.BackgroundTransparency = 1
Title.Position = UDim2.new(0, 0, 0, 10)
Title.Size = UDim2.new(1, 0, 0, 30)
Title.Font = Enum.Font.GothamBold
Title.Text = "ðŸŽ¯ ADVANCED AIMBOT"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 18

-- HÃ m táº¡o cÃ¡c tÃ¹y chá»n
local yOffset = 50
local function CreateOption(text, type, settingKey, minVal, maxVal, step)
    local Label = Instance.new("TextLabel")
    Label.Parent = MainFrame
    Label.BackgroundTransparency = 1
    Label.Position = UDim2.new(0.05, 0, 0, yOffset)
    Label.Size = UDim2.new(0.5, 0, 0, 30)
    Label.Font = Enum.Font.Gotham
    Label.Text = text
    Label.TextColor3 = Color3.fromRGB(200, 200, 200)
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.TextSize = 13
    
    local Button = Instance.new("TextButton")
    Button.Parent = MainFrame
    Button.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    Button.Position = UDim2.new(0.55, 0, 0, yOffset)
    Button.Size = UDim2.new(0.4, 0, 0, 30)
    Button.Font = Enum.Font.GothamBold
    Button.TextColor3 = Color3.fromRGB(0, 255, 100)
    Button.TextSize = 12
    
    local Corner = Instance.new("UICorner")
    Corner.CornerRadius = UDim.new(0, 6)
    Corner.Parent = Button
    
    if type == "Toggle" then
        Button.Text = SETTINGS[settingKey] and "ON" or "OFF"
        Button.TextColor3 = SETTINGS[settingKey] and Color3.fromRGB(0, 255, 100) or Color3.fromRGB(255, 50, 50)
        Button.MouseButton1Click:Connect(function()
            SETTINGS[settingKey] = not SETTINGS[settingKey]
            Button.Text = SETTINGS[settingKey] and "ON" or "OFF"
            Button.TextColor3 = SETTINGS[settingKey] and Color3.fromRGB(0, 255, 100) or Color3.fromRGB(255, 50, 50)
        end)
    elseif type == "Switch" then
        Button.Text = SETTINGS[settingKey] == "Head" and "HEAD" or "BODY"
        Button.MouseButton1Click:Connect(function()
            if SETTINGS[settingKey] == "Head" then 
                SETTINGS[settingKey] = "HumanoidRootPart" 
            else 
                SETTINGS[settingKey] = "Head" 
            end
            Button.Text = SETTINGS[settingKey] == "Head" and "HEAD" or "BODY"
        end)
    elseif type == "Slider" then
        local currentValue = SETTINGS[settingKey]
        Button.Text = string.format("%.2f", currentValue)
        
        Button.MouseButton1Click:Connect(function()
            currentValue = currentValue + step
            if currentValue > maxVal then currentValue = minVal end
            SETTINGS[settingKey] = currentValue
            Button.Text = string.format("%.2f", currentValue)
        end)
    end
    
    yOffset = yOffset + 40
end

-- Táº O CÃC TÃ™YCHá»ŒN
CreateOption("Enable Aimbot", "Toggle", "AimbotEnabled")
CreateOption("Team Check", "Toggle", "TeamCheck")
CreateOption("Aim Part", "Switch", "AimPart")
CreateOption("FOV Size", "Slider", "FOVSize", 50, 400, 50)
CreateOption("Smoothness", "Slider", "Smoothness", 0.05, 1.0, 0.05)
CreateOption("Distance Fix", "Slider", "DistanceMultiplier", 0.01, 0.10, 0.01)
CreateOption("Visible Check", "Toggle", "VisibleCheck")
CreateOption("Prediction", "Toggle", "PredictionEnabled")

-- ThÃªm hÆ°á»›ng dáº«n
local Note = Instance.new("TextLabel")
Note.Parent = MainFrame
Note.BackgroundTransparency = 1
Note.Position = UDim2.new(0.05, 0, 0, yOffset + 10)
Note.Size = UDim2.new(0.9, 0, 0, 50)
Note.Font = Enum.Font.Gotham
Note.Text = "Distance Fix: Sá»­a lá»‡ch khi báº¯n xa\nSmooth: 0.05 (MÆ°á»£t) -> 1.0 (DÃ­nh)\nKÃ©o nÃºt AIM Ä‘á»ƒ di chuyá»ƒn"
Note.TextColor3 = Color3.fromRGB(150, 150, 150)
Note.TextSize = 10
Note.TextWrapped = true
Note.TextYAlignment = Enum.TextYAlignment.Top

-- Toggle Menu
ToggleButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = not MainFrame.Visible
end)

-- 3. VÃ’NG TRÃ’N FOV
local FOVRing = Instance.new("ImageLabel")
FOVRing.Name = "FOVRing"
FOVRing.Parent = ScreenGui
FOVRing.AnchorPoint = Vector2.new(0.5, 0.5)
FOVRing.Position = UDim2.new(0.5, 0, 0.5, 0)
FOVRing.BackgroundTransparency = 1
FOVRing.Image = "rbxassetid://3570695787"
FOVRing.ImageColor3 = Color3.fromRGB(255, 50, 50)
FOVRing.ImageTransparency = 0.8
FOVRing.ScaleType = Enum.ScaleType.Fit

-- --- LOGIC AIMBOT ---

-- HÃ m kiá»ƒm tra táº§m nhÃ¬n
local function IsVisible(targetPart)
    if not SETTINGS.VisibleCheck then return true end
    local origin = Camera.CFrame.Position
    local direction = (targetPart.Position - origin).Unit * (targetPart.Position - origin).Magnitude
    local raycastParams = RaycastParams.new()
    raycastParams.FilterDescendantsInstances = {LocalPlayer.Character, ScreenGui}
    raycastParams.FilterType = Enum.RaycastFilterType.Exclude
    
    local result = Workspace:Raycast(origin, direction, raycastParams)
    if result then
        return result.Instance:IsDescendantOf(targetPart.Parent)
    end
    return false
end

-- HÃ m tÃ¬m Ä‘á»‹ch gáº§n nháº¥t
local function GetClosestTarget()
    local closestPlayer = nil
    local shortestDistance = SETTINGS.FOVSize
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Humanoid") and player.Character.Humanoid.Health > 0 and player.Character:FindFirstChild(SETTINGS.AimPart) then
            if SETTINGS.TeamCheck and player.Team == LocalPlayer.Team then continue end
            
            local targetPart = player.Character[SETTINGS.AimPart]
            local pos, onScreen = Camera:WorldToViewportPoint(targetPart.Position)
            
            if onScreen then
                local screenCenter = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
                local distance = (Vector2.new(pos.X, pos.Y) - screenCenter).Magnitude
                
                if distance < shortestDistance then
                    if IsVisible(targetPart) then
                        shortestDistance = distance
                        closestPlayer = player.Character
                    end
                end
            end
        end
    end
    return closestPlayer
end

-- VÃ’NG Láº¶P CHÃNH
RunService.RenderStepped:Connect(function()
    -- Cáº­p nháº­t FOV
    FOVRing.Size = UDim2.new(0, SETTINGS.FOVSize * 2, SETTINGS.FOVSize * 2)
    FOVRing.Visible = SETTINGS.AimbotEnabled
    
    if not SETTINGS.AimbotEnabled then return end
    
    CurrentTarget = GetClosestTarget()
    
    if CurrentTarget then
        FOVRing.ImageColor3 = Color3.fromRGB(0, 255, 100)
        
        local targetPart = CurrentTarget[SETTINGS.AimPart]
        local humanoid = CurrentTarget:FindFirstChild("Humanoid")
        
        -- TÃNH KHOáº¢NG CÃCH
        local distance = (targetPart.Position - Camera.CFrame.Position).Magnitude
        
        -- BÃ™ OFFSET THEO KHOáº¢NG CÃCH
        local dynamicOffset = 0
        if SETTINGS.AimPart == "Head" then
            dynamicOffset = math.clamp(distance * SETTINGS.DistanceMultiplier, 0, 6)
        end
        
        -- Vá»Š TRÃ AIM
        local aimPos = targetPart.Position + Vector3.new(0, dynamicOffset, 0)
        
        -- Dá»° ÄOÃN DI CHUYá»‚N
        if SETTINGS.PredictionEnabled and humanoid and humanoid.MoveDirection.Magnitude > 0 then
            local velocity = humanoid.MoveDirection * humanoid.WalkSpeed
            local timeToHit = distance / 500  -- Giáº£ Ä‘á»‹nh tá»‘c Ä‘á»™ Ä‘áº¡n 500 studs/s
            aimPos = aimPos + (velocity * timeToHit)
        end
        
        -- Táº O CFRAME
        local currentCFrame = Camera.CFrame
        local targetCFrame = CFrame.new(currentCFrame.Position, aimPos)
        
        -- SMOOTH AIM
        Camera.CFrame = currentCFrame:Lerp(targetCFrame, SETTINGS.Smoothness)
    else
        FOVRing.ImageColor3 = Color3.fromRGB(255, 50, 50)
    end
end)
