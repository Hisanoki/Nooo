local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer

-- --- Cáº¤U HÃŒNH ---
local CONFIG = {
    Range = 40, -- ÄÃ¢y lÃ  range cá»§a Bong bÃ³ng (Aim thá»±c táº¿ sáº½ lÃ  Range + 5)
    AllyName = "GrahamScyther",
    BubbleColor = Color3.fromRGB(0, 170, 255),
    BubbleTransparency = 0.6,
    SkillPrefix = "Kamen Rider",
    SkillSuffix = "Chalice",
    TeleportDelay = 0.3,
    TeleportCooldown = 5,
    SkillDelay = 0.2,
    SelectedSkills = {
        R = true,
        T = false,
        F = false,
        G = false
    }
}

-- --- BIáº¾N TRáº NG THÃI ---
local isAiming = false
local isAntiRunner = false
local currentTarget = nil
local lastTeleportTime = 0
local teleportCooldownRemaining = 0

-- --- Táº O GUI HIá»†N Äáº I (COMPACT) ---
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ModernAimGUI_MobileV2"
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.ResetOnSpawn = false

-- === NÃšT TP DI Äá»˜NG (TÃNH NÄ‚NG Má»šI) ===
local MobileTPBtn = Instance.new("TextButton")
MobileTPBtn.Name = "MobileTPButton"
MobileTPBtn.Parent = ScreenGui
MobileTPBtn.BackgroundColor3 = Color3.fromRGB(255, 80, 80) -- MÃ u Ä‘á» ná»•i báº­t
MobileTPBtn.Position = UDim2.new(0.85, 0, 0.6, 0) -- Vá»‹ trÃ­ máº·c Ä‘á»‹nh bÃªn pháº£i
MobileTPBtn.Size = UDim2.new(0, 30, 0, 30)
MobileTPBtn.Font = Enum.Font.GothamBold
MobileTPBtn.Text = "âš¡"
MobileTPBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
MobileTPBtn.TextSize = 30
MobileTPBtn.AutoButtonColor = true
MobileTPBtn.Active = true
MobileTPBtn.Draggable = true -- Cho phÃ©p kÃ©o di chuyá»ƒn

local TPBtnCorner = Instance.new("UICorner")
TPBtnCorner.CornerRadius = UDim.new(1, 0) -- HÃ¬nh trÃ²n
TPBtnCorner.Parent = MobileTPBtn

local TPBtnStroke = Instance.new("UIStroke")
TPBtnStroke.Color = Color3.fromRGB(255, 255, 255)
TPBtnStroke.Thickness = 2
TPBtnStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
TPBtnStroke.Parent = MobileTPBtn

-- Hiá»‡u á»©ng bÃ³ng Ä‘á»• cho nÃºt TP
local TPShadow = Instance.new("ImageLabel")
TPShadow.Name = "Shadow"
TPShadow.Parent = MobileTPBtn
TPShadow.AnchorPoint = Vector2.new(0.5, 0.5)
TPShadow.Position = UDim2.new(0.5, 0, 0.5, 0)
TPShadow.Size = UDim2.new(1.2, 0, 1.2, 0)
TPShadow.BackgroundTransparency = 1
TPShadow.Image = "rbxassetid://1316045217"
TPShadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
TPShadow.ImageTransparency = 0.6
TPShadow.ZIndex = -1
-- =======================================

-- Main Frame (Giá»¯ nguyÃªn nhÆ° cÅ©)
local MainFrame = Instance.new("ImageLabel")
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.Image = "rbxassetid://122727189017649"
MainFrame.ScaleType = Enum.ScaleType.Stretch
MainFrame.BackgroundTransparency = 1
MainFrame.Position = UDim2.new(0.5, -140, 0.1, 0)
MainFrame.Size = UDim2.new(0, 280, 0, 460)
MainFrame.Active = true
MainFrame.Draggable = true

local MainStroke = Instance.new("UIStroke")
MainStroke.Color = Color3.fromRGB(0, 120, 215)
MainStroke.Thickness = 2
MainStroke.Parent = MainFrame

-- Header
local Header = Instance.new("TextLabel")
Header.Parent = MainFrame
Header.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
Header.Size = UDim2.new(1, 0, 0, 40)
Header.Font = Enum.Font.GothamBold
Header.Text = "ðŸŽ¯ AIM PRO V2"
Header.TextColor3 = Color3.fromRGB(255, 255, 255)
Header.TextSize = 16

local HeaderCorner = Instance.new("UICorner")
HeaderCorner.CornerRadius = UDim.new(0, 10)
HeaderCorner.Parent = Header

-- NÃºt Ä‘Ã³ng/má»Ÿ GUI
local ToggleBtn = Instance.new("ImageButton")
ToggleBtn.Parent = ScreenGui
ToggleBtn.Image = "rbxassetid://122727189017649"
ToggleBtn.ScaleType = Enum.ScaleType.Stretch
ToggleBtn.BackgroundTransparency = 1
ToggleBtn.Position = UDim2.new(0.02, 0, 0.5, 0)
ToggleBtn.Size = UDim2.new(0, 45, 0, 45)
ToggleBtn.Active = true
ToggleBtn.Draggable = true

local ToggleBtnStroke = Instance.new("UIStroke")
ToggleBtnStroke.Color = Color3.fromRGB(0, 120, 215)
ToggleBtnStroke.Thickness = 2
ToggleBtnStroke.Parent = ToggleBtn

local ToggleCorner = Instance.new("UICorner")
ToggleCorner.CornerRadius = UDim.new(0, 22)
ToggleCorner.Parent = ToggleBtn

local ToggleBtnText = Instance.new("TextLabel")
ToggleBtnText.Parent = ToggleBtn
ToggleBtnText.BackgroundTransparency = 1
ToggleBtnText.Size = UDim2.new(1, 0, 1, 0)
ToggleBtnText.Font = Enum.Font.GothamBold
ToggleBtnText.Text = "â˜°"
ToggleBtnText.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleBtnText.TextSize = 22

local guiVisible = true
ToggleBtn.MouseButton1Click:Connect(function()
    guiVisible = not guiVisible
    MainFrame.Visible = guiVisible
    ToggleBtnText.Text = guiVisible and "â˜°" or "+"
end)

-- Cooldown Timer Display
local CooldownFrame = Instance.new("Frame")
CooldownFrame.Parent = ScreenGui
CooldownFrame.BackgroundColor3 = Color3.fromRGB(0, 90, 160)
CooldownFrame.Position = UDim2.new(0.02, 0, 0.1, 0)
CooldownFrame.Size = UDim2.new(0, 90, 0, 55)
CooldownFrame.Visible = false

local CooldownCorner = Instance.new("UICorner")
CooldownCorner.CornerRadius = UDim.new(0, 10)
CooldownCorner.Parent = CooldownFrame

local CooldownLabel = Instance.new("TextLabel")
CooldownLabel.Parent = CooldownFrame
CooldownLabel.BackgroundTransparency = 1
CooldownLabel.Size = UDim2.new(1, 0, 0.5, 0)
CooldownLabel.Font = Enum.Font.GothamBold
CooldownLabel.Text = "TP CD"
CooldownLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
CooldownLabel.TextSize = 13

local CooldownTimer = Instance.new("TextLabel")
CooldownTimer.Parent = CooldownFrame
CooldownTimer.BackgroundTransparency = 1
CooldownTimer.Position = UDim2.new(0, 0, 0.5, 0)
CooldownTimer.Size = UDim2.new(1, 0, 0.5, 0)
CooldownTimer.Font = Enum.Font.GothamBold
CooldownTimer.Text = "0.0s"
CooldownTimer.TextColor3 = Color3.fromRGB(255, 255, 255)
CooldownTimer.TextSize = 18

-- ScrollingFrame
local ScrollFrame = Instance.new("ScrollingFrame")
ScrollFrame.Parent = MainFrame
ScrollFrame.BackgroundTransparency = 1
ScrollFrame.Position = UDim2.new(0, 0, 0, 45)
ScrollFrame.Size = UDim2.new(1, 0, 1, -45)
ScrollFrame.CanvasSize = UDim2.new(0, 0, 0, 650)
ScrollFrame.ScrollBarThickness = 4
ScrollFrame.ScrollBarImageColor3 = Color3.fromRGB(0, 120, 215)

-- Functions táº¡o GUI components
local function CreateToggle(name, text, position)
    local frame = Instance.new("Frame")
    frame.Parent = ScrollFrame
    frame.BackgroundColor3 = Color3.fromRGB(0, 80, 140)
    frame.Position = position
    frame.Size = UDim2.new(0.9, 0, 0, 42)
    local corner = Instance.new("UICorner") corner.CornerRadius = UDim.new(0, 7) corner.Parent = frame
    local label = Instance.new("TextLabel") label.Parent = frame label.BackgroundTransparency = 1 label.Position = UDim2.new(0.05, 0, 0, 0) label.Size = UDim2.new(0.62, 0, 1, 0) label.Font = Enum.Font.GothamBold label.Text = text label.TextColor3 = Color3.fromRGB(255, 255, 255) label.TextSize = 13 label.TextXAlignment = Enum.TextXAlignment.Left
    local toggle = Instance.new("TextButton") toggle.Parent = frame toggle.BackgroundColor3 = Color3.fromRGB(0, 60, 110) toggle.Position = UDim2.new(0.69, 0, 0.18, 0) toggle.Size = UDim2.new(0.26, 0, 0.64, 0) toggle.Font = Enum.Font.GothamBold toggle.Text = "OFF" toggle.TextColor3 = Color3.fromRGB(255, 80, 80) toggle.TextSize = 11
    local toggleCorner = Instance.new("UICorner") toggleCorner.CornerRadius = UDim.new(0, 5) toggleCorner.Parent = toggle
    return toggle, label
end

local function CreateInput(name, labelText, position, defaultValue)
    local frame = Instance.new("Frame") frame.Parent = ScrollFrame frame.BackgroundColor3 = Color3.fromRGB(0, 80, 140) frame.Position = position frame.Size = UDim2.new(0.9, 0, 0, 42)
    local corner = Instance.new("UICorner") corner.CornerRadius = UDim.new(0, 7) corner.Parent = frame
    local label = Instance.new("TextLabel") label.Parent = frame label.BackgroundTransparency = 1 label.Position = UDim2.new(0.05, 0, 0, 0) label.Size = UDim2.new(0.52, 0, 1, 0) label.Font = Enum.Font.GothamBold label.Text = labelText label.TextColor3 = Color3.fromRGB(255, 255, 255) label.TextSize = 12 label.TextXAlignment = Enum.TextXAlignment.Left
    local input = Instance.new("TextBox") input.Parent = frame input.BackgroundColor3 = Color3.fromRGB(0, 100, 180) input.Position = UDim2.new(0.59, 0, 0.18, 0) input.Size = UDim2.new(0.36, 0, 0.64, 0) input.Font = Enum.Font.Gotham input.Text = tostring(defaultValue) input.TextColor3 = Color3.fromRGB(255, 255, 255) input.TextSize = 13 input.ClearTextOnFocus = false
    local inputCorner = Instance.new("UICorner") inputCorner.CornerRadius = UDim.new(0, 5) inputCorner.Parent = input
    return input
end

local function CreateSectionLabel(text, position)
    local label = Instance.new("TextLabel") label.Parent = ScrollFrame label.BackgroundTransparency = 1 label.Position = position label.Size = UDim2.new(0.9, 0, 0, 22) label.Font = Enum.Font.GothamBold label.Text = text label.TextColor3 = Color3.fromRGB(100, 200, 255) label.TextSize = 12 label.TextXAlignment = Enum.TextXAlignment.Left
    return label
end

local function CreateSkillToggle(skillKey, position)
    local toggle = Instance.new("TextButton") toggle.Parent = ScrollFrame toggle.BackgroundColor3 = CONFIG.SelectedSkills[skillKey] and Color3.fromRGB(0, 120, 80) or Color3.fromRGB(0, 60, 110) toggle.Position = position toggle.Size = UDim2.new(0.2, 0, 0, 36) toggle.Font = Enum.Font.GothamBold toggle.Text = skillKey toggle.TextColor3 = CONFIG.SelectedSkills[skillKey] and Color3.fromRGB(80, 255, 80) or Color3.fromRGB(255, 80, 80) toggle.TextSize = 15
    local corner = Instance.new("UICorner") corner.CornerRadius = UDim.new(0, 7) corner.Parent = toggle
    return toggle
end

-- Táº¡o Controls
local yPos = 10
CreateSectionLabel("âš™ï¸ TÃNH NÄ‚NG", UDim2.new(0.05, 0, 0, yPos)) yPos = yPos + 28
local AimToggle = CreateToggle("AimToggle", "ðŸŽ¯ Aim Assist", UDim2.new(0.05, 0, 0, yPos)) yPos = yPos + 48
local AntiToggle = CreateToggle("AntiToggle", "âš¡ Kháº¯c Runner", UDim2.new(0.05, 0, 0, yPos)) yPos = yPos + 58
CreateSectionLabel("âš”ï¸ CHá»ŒN SKILL AUTO TP:", UDim2.new(0.05, 0, 0, yPos)) yPos = yPos + 28
local SkillR = CreateSkillToggle("R", UDim2.new(0.05, 0, 0, yPos))
local SkillT = CreateSkillToggle("T", UDim2.new(0.28, 0, 0, yPos))
local SkillF = CreateSkillToggle("F", UDim2.new(0.51, 0, 0, yPos))
local SkillG = CreateSkillToggle("G", UDim2.new(0.74, 0, 0, yPos)) yPos = yPos + 48
CreateSectionLabel("ðŸ”§ CÃ€I Äáº¶T", UDim2.new(0.05, 0, 0, yPos)) yPos = yPos + 28
local CharacterInput = CreateInput("CharacterInput", "ðŸŽ­ TÆ°á»›ng:", UDim2.new(0.05, 0, 0, yPos), CONFIG.SkillSuffix) yPos = yPos + 48
local RangeInput = CreateInput("RangeInput", "ðŸ“ Bubble Size:", UDim2.new(0.05, 0, 0, yPos), CONFIG.Range) yPos = yPos + 48
local TPDelayInput = CreateInput("TPDelayInput", "â±ï¸ TP Delay:", UDim2.new(0.05, 0, 0, yPos), CONFIG.TeleportDelay) yPos = yPos + 48
local TPCooldownInput = CreateInput("TPCooldownInput", "â³ TP CD:", UDim2.new(0.05, 0, 0, yPos), CONFIG.TeleportCooldown) yPos = yPos + 48
local SkillDelayInput = CreateInput("SkillDelayInput", "âš¡ Skill Delay:", UDim2.new(0.05, 0, 0, yPos), CONFIG.SkillDelay) yPos = yPos + 48
local BubbleInput = CreateInput("BubbleInput", "ðŸ’§ Bubble:", UDim2.new(0.05, 0, 0, yPos), CONFIG.BubbleTransparency) yPos = yPos + 58
local Credit = Instance.new("TextLabel") Credit.Parent = ScrollFrame Credit.BackgroundTransparency = 1 Credit.Position = UDim2.new(0, 0, 0, yPos) Credit.Size = UDim2.new(1, 0, 0, 22) Credit.Font = Enum.Font.GothamBold Credit.Text = "Added Mobile TP Button âš¡" Credit.TextColor3 = Color3.fromRGB(150, 200, 255) Credit.TextSize = 10
ScrollFrame.CanvasSize = UDim2.new(0, 0, 0, yPos + 30)

-- --- Táº O VISUAL BUBBLE ---
local BubblePart = Instance.new("Part")
BubblePart.Name = "AimRangeBubble"
BubblePart.Shape = Enum.PartType.Ball
BubblePart.Material = Enum.Material.ForceField
BubblePart.Size = Vector3.new(CONFIG.Range * 2, CONFIG.Range * 2, CONFIG.Range * 2)
BubblePart.Color = CONFIG.BubbleColor
BubblePart.Transparency = 1
BubblePart.CanCollide = false
BubblePart.Anchored = true
BubblePart.CastShadow = false
BubblePart.Parent = workspace

-- --- HÃ€M TÃŒM Má»¤C TIÃŠU Cáº¢I TIáº¾N ---
-- Nháº­n tham sá»‘ searchRange Ä‘á»ƒ cÃ³ thá»ƒ chá»‰nh Aim xa hÆ¡n Bubble
local function GetClosestEnemy(searchRange)
    local closestPlayer = nil
    local shortestDistance = searchRange -- DÃ¹ng range Ä‘Æ°á»£c truyá»n vÃ o
    local myCharacter = LocalPlayer.Character
    if not myCharacter or not myCharacter:FindFirstChild("HumanoidRootPart") then return nil end
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Name ~= CONFIG.AllyName and player.Character and player.Character:FindFirstChild("Humanoid") and player.Character.Humanoid.Health > 0 then
            local root = player.Character:FindFirstChild("HumanoidRootPart")
            if root then
                local distance = (root.Position - myCharacter.HumanoidRootPart.Position).Magnitude
                if distance < shortestDistance then
                    shortestDistance = distance
                    closestPlayer = player.Character
                end
            end
        end
    end
    return closestPlayer
end

-- --- HÃ€M THá»°C HIá»†N TELEPORT (Core Logic) ---
local function ExecuteTeleport(target)
    if not target or not target:FindFirstChild("HumanoidRootPart") then return end
    
    local myChar = LocalPlayer.Character
    if myChar and myChar:FindFirstChild("HumanoidRootPart") then
        local targetCFrame = target.HumanoidRootPart.CFrame
        -- Teleport ra sau lÆ°ng (Back) thay vÃ¬ trÆ°á»›c máº·t (-5 lÃ  trÆ°á»›c, 5 lÃ  sau)
        -- Chá»‰nh láº¡i thÃ nh 3 stud phÃ­a sau lÆ°ng Ä‘á»‹ch Ä‘á»ƒ dá»… combo
        local backPosition = targetCFrame * CFrame.new(0, 0, 3) 
        
        myChar.HumanoidRootPart.CFrame = CFrame.lookAt(backPosition.Position, target.HumanoidRootPart.Position)
        
        lastTeleportTime = tick()
        teleportCooldownRemaining = CONFIG.TeleportCooldown
        CooldownFrame.Visible = true
    end
end

-- --- TELEPORT Tá»° Äá»˜NG (Auto Anti-Runner) ---
local function AutoTeleportToTarget()
    local currentTime = tick()
    if currentTime - lastTeleportTime < CONFIG.TeleportCooldown then return end
    
    task.wait(CONFIG.TeleportDelay)
    
    -- Anti-Runner dÃ¹ng range rá»™ng hÆ¡n bong bÃ³ng (Range + 5)
    local target = GetClosestEnemy(CONFIG.Range + 5)
    if target then
        ExecuteTeleport(target)
    end
end

-- --- TELEPORT THá»¦ CÃ”NG (NÃšT Báº¤M DI Äá»˜NG) ---
MobileTPBtn.MouseButton1Click:Connect(function()
    -- NÃºt thá»§ cÃ´ng bá» qua Cooldown hoáº·c dÃ¹ng Cooldown riÃªng tuá»³ báº¡n.
    -- á»ž Ä‘Ã¢y tÃ´i Ä‘á»ƒ nÃ³ tuÃ¢n theo Cooldown chung Ä‘á»ƒ trÃ¡nh bá»‹ kick
    local currentTime = tick()
    if currentTime - lastTeleportTime < CONFIG.TeleportCooldown then 
        -- Náº¿u Ä‘ang cooldown, táº¡o hiá»‡u á»©ng rung hoáº·c Ä‘á» nÃºt (optional)
        return 
    end
    
    -- TÃ¬m Ä‘á»‹ch trong range Aim (Range + 5)
    local target = GetClosestEnemy(CONFIG.Range + 5)
    if target then
        ExecuteTeleport(target)
    else
        print("KhÃ´ng tÃ¬m tháº¥y Ä‘á»‹ch trong range!")
    end
end)

-- Hook vÃ o Remote (Giá»¯ nguyÃªn logic cÅ©)
local oldNamecall
oldNamecall = hookmetamethod(game, "__namecall", function(self, ...)
    local args = {...}
    local method = getnamecallmethod()
    
    if method == "FireServer" and self.Name == "Remote" then
        if isAntiRunner and CONFIG.SelectedSkills[args[1]] then
            task.spawn(AutoTeleportToTarget)
        end
    end
    
    return oldNamecall(self, ...)
end)

-- Logic Toggle Buttons
AimToggle.MouseButton1Click:Connect(function()
    isAiming = not isAiming
    AimToggle.Text = isAiming and "ON" or "OFF"
    AimToggle.TextColor3 = isAiming and Color3.fromRGB(80, 255, 80) or Color3.fromRGB(255, 80, 80)
    AimToggle.BackgroundColor3 = isAiming and Color3.fromRGB(0, 120, 80) or Color3.fromRGB(0, 60, 110)
    BubblePart.Transparency = isAiming and CONFIG.BubbleTransparency or 1
end)

AntiToggle.MouseButton1Click:Connect(function()
    isAntiRunner = not isAntiRunner
    AntiToggle.Text = isAntiRunner and "ON" or "OFF"
    AntiToggle.TextColor3 = isAntiRunner and Color3.fromRGB(80, 255, 80) or Color3.fromRGB(255, 80, 80)
    AntiToggle.BackgroundColor3 = isAntiRunner and Color3.fromRGB(0, 120, 80) or Color3.fromRGB(0, 60, 110)
end)

local function SetupSkillToggle(button, skillKey)
    button.MouseButton1Click:Connect(function()
        CONFIG.SelectedSkills[skillKey] = not CONFIG.SelectedSkills[skillKey]
        button.Text = skillKey
        button.TextColor3 = CONFIG.SelectedSkills[skillKey] and Color3.fromRGB(80, 255, 80) or Color3.fromRGB(255, 80, 80)
        button.BackgroundColor3 = CONFIG.SelectedSkills[skillKey] and Color3.fromRGB(0, 120, 80) or Color3.fromRGB(0, 60, 110)
    end)
end
SetupSkillToggle(SkillR, "R") SetupSkillToggle(SkillT, "T") SetupSkillToggle(SkillF, "F") SetupSkillToggle(SkillG, "G")

CharacterInput.FocusLost:Connect(function()
    local newName = CharacterInput.Text:gsub("^%s*(.-)%s*$", "%1")
    if newName == "" then CharacterInput.Text = CONFIG.SkillSuffix return end
    if not newName:find("Kamen Rider") then CONFIG.SkillSuffix = newName else CONFIG.SkillSuffix = newName:gsub("Kamen Rider ", "") end
    CharacterInput.Text = CONFIG.SkillSuffix
end)

-- Cáº­p nháº­t Range vÃ  Bubble
RangeInput.FocusLost:Connect(function()
    local newRange = tonumber(RangeInput.Text)
    if newRange and newRange > 0 then
        CONFIG.Range = newRange
        -- Bong bÃ³ng chá»‰ to báº±ng Range nháº­p vÃ o
        BubblePart.Size = Vector3.new(newRange * 2, newRange * 2, newRange * 2)
        print("âœ… Bubble Range: " .. newRange .. " | Aim Range: " .. (newRange + 5))
    else
        RangeInput.Text = tostring(CONFIG.Range)
    end
end)

TPDelayInput.FocusLost:Connect(function() local v = tonumber(TPDelayInput.Text) if v and v>=0 then CONFIG.TeleportDelay = v else TPDelayInput.Text = tostring(CONFIG.TeleportDelay) end end)
TPCooldownInput.FocusLost:Connect(function() local v = tonumber(TPCooldownInput.Text) if v and v>=0 then CONFIG.TeleportCooldown = v else TPCooldownInput.Text = tostring(CONFIG.TeleportCooldown) end end)
SkillDelayInput.FocusLost:Connect(function() local v = tonumber(SkillDelayInput.Text) if v and v>=0 then CONFIG.SkillDelay = v else SkillDelayInput.Text = tostring(CONFIG.SkillDelay) end end)
BubbleInput.FocusLost:Connect(function() local v = tonumber(BubbleInput.Text) if v and v>=0 and v<=1 then CONFIG.BubbleTransparency = v if isAiming then BubblePart.Transparency = v end else BubbleInput.Text = tostring(CONFIG.BubbleTransparency) end end)

-- --- VÃ’NG Láº¶P CHÃNH ---
RunService.RenderStepped:Connect(function()
    local char = LocalPlayer.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then
        BubblePart.Position = Vector3.new(0, -1000, 0)
        return
    end
    
    BubblePart.Position = char.HumanoidRootPart.Position
    
    if teleportCooldownRemaining > 0 then
        teleportCooldownRemaining = math.max(0, teleportCooldownRemaining - RunService.RenderStepped:Wait())
        CooldownTimer.Text = string.format("%.1fs", teleportCooldownRemaining)
        if teleportCooldownRemaining <= 0 then CooldownFrame.Visible = false end
    end
    
    if isAiming then
        -- QUAN TRá»ŒNG: Aim sá»­ dá»¥ng Range + 5
        local target = GetClosestEnemy(CONFIG.Range + 5)
        if target and target:FindFirstChild("HumanoidRootPart") then
            local targetPos = target.HumanoidRootPart.Position
            local myPos = char.HumanoidRootPart.Position
            char.HumanoidRootPart.CFrame = CFrame.lookAt(myPos, Vector3.new(targetPos.X, myPos.Y, targetPos.Z))
        end
    end
end)
