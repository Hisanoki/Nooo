local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer

-- --- Cáº¤U HÃŒNH ---
local CONFIG = {
    Range = 40,
    AllyName = "GrahamScyther",
    BubbleColor = Color3.fromRGB(0, 170, 255),
    BubbleTransparency = 0.6,
    SkillPrefix = "Kamen Rider",
    SkillSuffix = "Chalice",
    TeleportDelay = 0.3,
    TeleportCooldown = 5,
    SkillDelay = 0.2,
    SelectedSkills = {
        R = true,
        T = false,
        F = false,
        G = false
    }
}

-- --- BIáº¾N TRáº NG THÃI ---
local isAiming = false
local isAntiRunner = false
local currentTarget = nil
local lastTeleportTime = 0
local teleportCooldownRemaining = 0

-- --- Táº O GUI HIá»†N Äáº I (COMPACT) ---
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ModernAimGUI"
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.ResetOnSpawn = false

-- Main Frame (cÃ³ thá»ƒ kÃ©o) - Nhá» gá»n hÆ¡n
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
MainFrame.Position = UDim2.new(0.5, -140, 0.1, 0)
MainFrame.Size = UDim2.new(0, 280, 0, 460)
MainFrame.Active = true
MainFrame.Draggable = true

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 10)
MainCorner.Parent = MainFrame

local MainStroke = Instance.new("UIStroke")
MainStroke.Color = Color3.fromRGB(0, 170, 255)
MainStroke.Thickness = 2
MainStroke.Parent = MainFrame

-- Header
local Header = Instance.new("TextLabel")
Header.Parent = MainFrame
Header.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
Header.Size = UDim2.new(1, 0, 0, 40)
Header.Font = Enum.Font.GothamBold
Header.Text = "ðŸŽ¯ AIM PRO"
Header.TextColor3 = Color3.fromRGB(255, 255, 255)
Header.TextSize = 16

local HeaderCorner = Instance.new("UICorner")
HeaderCorner.CornerRadius = UDim.new(0, 10)
HeaderCorner.Parent = Header

-- NÃºt Ä‘Ã³ng/má»Ÿ GUI
local ToggleBtn = Instance.new("TextButton")
ToggleBtn.Parent = ScreenGui
ToggleBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
ToggleBtn.Position = UDim2.new(0.02, 0, 0.5, 0)
ToggleBtn.Size = UDim2.new(0, 45, 0, 45)
ToggleBtn.Font = Enum.Font.GothamBold
ToggleBtn.Text = "â˜°"
ToggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleBtn.TextSize = 22

local ToggleCorner = Instance.new("UICorner")
ToggleCorner.CornerRadius = UDim.new(0, 22)
ToggleCorner.Parent = ToggleBtn

local guiVisible = true
ToggleBtn.MouseButton1Click:Connect(function()
    guiVisible = not guiVisible
    MainFrame.Visible = guiVisible
    ToggleBtn.Text = guiVisible and "â˜°" or "+"
end)

-- Cooldown Timer Display
local CooldownFrame = Instance.new("Frame")
CooldownFrame.Parent = ScreenGui
CooldownFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
CooldownFrame.Position = UDim2.new(0.02, 0, 0.1, 0)
CooldownFrame.Size = UDim2.new(0, 90, 0, 55)
CooldownFrame.Visible = false

local CooldownCorner = Instance.new("UICorner")
CooldownCorner.CornerRadius = UDim.new(0, 10)
CooldownCorner.Parent = CooldownFrame

local CooldownLabel = Instance.new("TextLabel")
CooldownLabel.Parent = CooldownFrame
CooldownLabel.BackgroundTransparency = 1
CooldownLabel.Size = UDim2.new(1, 0, 0.5, 0)
CooldownLabel.Font = Enum.Font.GothamBold
CooldownLabel.Text = "TP CD"
CooldownLabel.TextColor3 = Color3.fromRGB(255, 170, 0)
CooldownLabel.TextSize = 13

local CooldownTimer = Instance.new("TextLabel")
CooldownTimer.Parent = CooldownFrame
CooldownTimer.BackgroundTransparency = 1
CooldownTimer.Position = UDim2.new(0, 0, 0.5, 0)
CooldownTimer.Size = UDim2.new(1, 0, 0.5, 0)
CooldownTimer.Font = Enum.Font.GothamBold
CooldownTimer.Text = "0.0s"
CooldownTimer.TextColor3 = Color3.fromRGB(255, 255, 255)
CooldownTimer.TextSize = 18

-- ScrollingFrame Ä‘á»ƒ chá»©a táº¥t cáº£ controls
local ScrollFrame = Instance.new("ScrollingFrame")
ScrollFrame.Parent = MainFrame
ScrollFrame.BackgroundTransparency = 1
ScrollFrame.Position = UDim2.new(0, 0, 0, 45)
ScrollFrame.Size = UDim2.new(1, 0, 1, -45)
ScrollFrame.CanvasSize = UDim2.new(0, 0, 0, 650)
ScrollFrame.ScrollBarThickness = 4

-- HÃ m táº¡o Toggle Button (compact)
local function CreateToggle(name, text, position)
    local frame = Instance.new("Frame")
    frame.Parent = ScrollFrame
    frame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
    frame.Position = position
    frame.Size = UDim2.new(0.9, 0, 0, 42)
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 7)
    corner.Parent = frame
    
    local label = Instance.new("TextLabel")
    label.Parent = frame
    label.BackgroundTransparency = 1
    label.Position = UDim2.new(0.05, 0, 0, 0)
    label.Size = UDim2.new(0.62, 0, 1, 0)
    label.Font = Enum.Font.GothamBold
    label.Text = text
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextSize = 13
    label.TextXAlignment = Enum.TextXAlignment.Left
    
    local toggle = Instance.new("TextButton")
    toggle.Parent = frame
    toggle.BackgroundColor3 = Color3.fromRGB(60, 60, 65)
    toggle.Position = UDim2.new(0.69, 0, 0.18, 0)
    toggle.Size = UDim2.new(0.26, 0, 0.64, 0)
    toggle.Font = Enum.Font.GothamBold
    toggle.Text = "OFF"
    toggle.TextColor3 = Color3.fromRGB(255, 80, 80)
    toggle.TextSize = 11
    
    local toggleCorner = Instance.new("UICorner")
    toggleCorner.CornerRadius = UDim.new(0, 5)
    toggleCorner.Parent = toggle
    
    return toggle, label
end

-- HÃ m táº¡o Input Box (compact)
local function CreateInput(name, labelText, position, defaultValue)
    local frame = Instance.new("Frame")
    frame.Parent = ScrollFrame
    frame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
    frame.Position = position
    frame.Size = UDim2.new(0.9, 0, 0, 42)
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 7)
    corner.Parent = frame
    
    local label = Instance.new("TextLabel")
    label.Parent = frame
    label.BackgroundTransparency = 1
    label.Position = UDim2.new(0.05, 0, 0, 0)
    label.Size = UDim2.new(0.52, 0, 1, 0)
    label.Font = Enum.Font.GothamBold
    label.Text = labelText
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextSize = 12
    label.TextXAlignment = Enum.TextXAlignment.Left
    
    local input = Instance.new("TextBox")
    input.Parent = frame
    input.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
    input.Position = UDim2.new(0.59, 0, 0.18, 0)
    input.Size = UDim2.new(0.36, 0, 0.64, 0)
    input.Font = Enum.Font.Gotham
    input.Text = tostring(defaultValue)
    input.TextColor3 = Color3.fromRGB(255, 255, 255)
    input.TextSize = 13
    input.ClearTextOnFocus = false
    
    local inputCorner = Instance.new("UICorner")
    inputCorner.CornerRadius = UDim.new(0, 5)
    inputCorner.Parent = input
    
    return input
end

-- HÃ m táº¡o Section Label
local function CreateSectionLabel(text, position)
    local label = Instance.new("TextLabel")
    label.Parent = ScrollFrame
    label.BackgroundTransparency = 1
    label.Position = position
    label.Size = UDim2.new(0.9, 0, 0, 22)
    label.Font = Enum.Font.GothamBold
    label.Text = text
    label.TextColor3 = Color3.fromRGB(0, 170, 255)
    label.TextSize = 12
    label.TextXAlignment = Enum.TextXAlignment.Left
    return label
end

-- HÃ m táº¡o Skill Toggle (4 nÃºt cáº¡nh nhau, nhá» gá»n)
local function CreateSkillToggle(skillKey, position)
    local toggle = Instance.new("TextButton")
    toggle.Parent = ScrollFrame
    toggle.BackgroundColor3 = CONFIG.SelectedSkills[skillKey] and Color3.fromRGB(40, 100, 40) or Color3.fromRGB(60, 60, 65)
    toggle.Position = position
    toggle.Size = UDim2.new(0.2, 0, 0, 36)
    toggle.Font = Enum.Font.GothamBold
    toggle.Text = skillKey
    toggle.TextColor3 = CONFIG.SelectedSkills[skillKey] and Color3.fromRGB(80, 255, 80) or Color3.fromRGB(255, 80, 80)
    toggle.TextSize = 15
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 7)
    corner.Parent = toggle
    
    return toggle
end

-- Táº¡o cÃ¡c controls
local yPos = 10

-- Section: TÃ­nh nÄƒng chÃ­nh
CreateSectionLabel("âš™ï¸ TÃNH NÄ‚NG", UDim2.new(0.05, 0, 0, yPos))
yPos = yPos + 28

local AimToggle = CreateToggle("AimToggle", "ðŸŽ¯ Aim Assist", UDim2.new(0.05, 0, 0, yPos))
yPos = yPos + 48

local AntiToggle = CreateToggle("AntiToggle", "âš¡ Kháº¯c Runner", UDim2.new(0.05, 0, 0, yPos))
yPos = yPos + 58

-- Section: Chá»n Skill
CreateSectionLabel("âš”ï¸ CHá»ŒN SKILL AUTO TP:", UDim2.new(0.05, 0, 0, yPos))
yPos = yPos + 28

local SkillR = CreateSkillToggle("R", UDim2.new(0.05, 0, 0, yPos))
local SkillT = CreateSkillToggle("T", UDim2.new(0.28, 0, 0, yPos))
local SkillF = CreateSkillToggle("F", UDim2.new(0.51, 0, 0, yPos))
local SkillG = CreateSkillToggle("G", UDim2.new(0.74, 0, 0, yPos))
yPos = yPos + 48

-- Section: CÃ i Ä‘áº·t
CreateSectionLabel("ðŸ”§ CÃ€I Äáº¶T", UDim2.new(0.05, 0, 0, yPos))
yPos = yPos + 28

local CharacterInput = CreateInput("CharacterInput", "ðŸŽ­ TÆ°á»›ng:", UDim2.new(0.05, 0, 0, yPos), CONFIG.SkillSuffix)
yPos = yPos + 48

local RangeInput = CreateInput("RangeInput", "ðŸ“ Range:", UDim2.new(0.05, 0, 0, yPos), CONFIG.Range)
yPos = yPos + 48

local TPDelayInput = CreateInput("TPDelayInput", "â±ï¸ TP Delay:", UDim2.new(0.05, 0, 0, yPos), CONFIG.TeleportDelay)
yPos = yPos + 48

local TPCooldownInput = CreateInput("TPCooldownInput", "â³ TP CD:", UDim2.new(0.05, 0, 0, yPos), CONFIG.TeleportCooldown)
yPos = yPos + 48

local SkillDelayInput = CreateInput("SkillDelayInput", "âš¡ Skill Delay:", UDim2.new(0.05, 0, 0, yPos), CONFIG.SkillDelay)
yPos = yPos + 48

local BubbleInput = CreateInput("BubbleInput", "ðŸ’§ Bubble:", UDim2.new(0.05, 0, 0, yPos), CONFIG.BubbleTransparency)
yPos = yPos + 58

-- Credit
local Credit = Instance.new("TextLabel")
Credit.Parent = ScrollFrame
Credit.BackgroundTransparency = 1
Credit.Position = UDim2.new(0, 0, 0, yPos)
Credit.Size = UDim2.new(1, 0, 0, 22)
Credit.Font = Enum.Font.GothamBold
Credit.Text = "Made for Mobile ðŸ“±"
Credit.TextColor3 = Color3.fromRGB(150, 150, 155)
Credit.TextSize = 10

-- Cáº­p nháº­t canvas size
ScrollFrame.CanvasSize = UDim2.new(0, 0, 0, yPos + 30)

-- --- HÃ€M TÃŒM REMOTE ---
local function GetSkillRemote()
    local fullName = CONFIG.SkillPrefix .. " " .. CONFIG.SkillSuffix
    local tool = LocalPlayer.Backpack:FindFirstChild(fullName) or LocalPlayer.Character:FindFirstChild(fullName)
    if tool then
        return tool:FindFirstChild("Remote")
    end
    return nil
end

-- --- Táº O VISUAL BUBBLE ---
local BubblePart = Instance.new("Part")
BubblePart.Name = "AimRangeBubble"
BubblePart.Shape = Enum.PartType.Ball
BubblePart.Material = Enum.Material.ForceField
BubblePart.Size = Vector3.new(CONFIG.Range * 2, CONFIG.Range * 2, CONFIG.Range * 2)
BubblePart.Color = CONFIG.BubbleColor
BubblePart.Transparency = 1
BubblePart.CanCollide = false
BubblePart.Anchored = true
BubblePart.CastShadow = false
BubblePart.Parent = workspace

-- --- HÃ€M TÃŒM Má»¤C TIÃŠU ---
local function GetClosestEnemy()
    local closestPlayer = nil
    local shortestDistance = CONFIG.Range
    local myCharacter = LocalPlayer.Character
    if not myCharacter or not myCharacter:FindFirstChild("HumanoidRootPart") then return nil end
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Name ~= CONFIG.AllyName and player.Character and player.Character:FindFirstChild("Humanoid") and player.Character.Humanoid.Health > 0 then
            local root = player.Character:FindFirstChild("HumanoidRootPart")
            if root then
                local distance = (root.Position - myCharacter.HumanoidRootPart.Position).Magnitude
                if distance < shortestDistance then
                    shortestDistance = distance
                    closestPlayer = player.Character
                end
            end
        end
    end
    return closestPlayer
end

-- --- TELEPORT KHI DÃ™NG SKILL ---
local function TeleportToTarget()
    local currentTime = tick()
    if currentTime - lastTeleportTime < CONFIG.TeleportCooldown then
        return
    end
    
    task.wait(CONFIG.TeleportDelay)
    
    local target = GetClosestEnemy()
    if target and target:FindFirstChild("HumanoidRootPart") then
        local myChar = LocalPlayer.Character
        if myChar and myChar:FindFirstChild("HumanoidRootPart") then
            local targetCFrame = target.HumanoidRootPart.CFrame
            local frontPosition = targetCFrame * CFrame.new(0, 0, -5)
            
            myChar.HumanoidRootPart.CFrame = CFrame.new(frontPosition.Position, target.HumanoidRootPart.Position)
            
            lastTeleportTime = tick()
            teleportCooldownRemaining = CONFIG.TeleportCooldown
            CooldownFrame.Visible = true
        end
    end
end

-- Hook vÃ o Remote
local oldNamecall
oldNamecall = hookmetamethod(game, "__namecall", function(self, ...)
    local args = {...}
    local method = getnamecallmethod()
    
    if method == "FireServer" and self.Name == "Remote" then
        -- Kiá»ƒm tra náº¿u skill Ä‘Æ°á»£c chá»n vÃ  Anti-Runner Ä‘ang báº­t
        if isAntiRunner and CONFIG.SelectedSkills[args[1]] then
            task.spawn(TeleportToTarget)
        end
    end
    
    return oldNamecall(self, ...)
end)

-- --- LOGIC NÃšT Báº¤M ---
AimToggle.MouseButton1Click:Connect(function()
    isAiming = not isAiming
    AimToggle.Text = isAiming and "ON" or "OFF"
    AimToggle.TextColor3 = isAiming and Color3.fromRGB(80, 255, 80) or Color3.fromRGB(255, 80, 80)
    AimToggle.BackgroundColor3 = isAiming and Color3.fromRGB(40, 100, 40) or Color3.fromRGB(60, 60, 65)
    BubblePart.Transparency = isAiming and CONFIG.BubbleTransparency or 1
end)

AntiToggle.MouseButton1Click:Connect(function()
    isAntiRunner = not isAntiRunner
    AntiToggle.Text = isAntiRunner and "ON" or "OFF"
    AntiToggle.TextColor3 = isAntiRunner and Color3.fromRGB(80, 255, 80) or Color3.fromRGB(255, 80, 80)
    AntiToggle.BackgroundColor3 = isAntiRunner and Color3.fromRGB(40, 100, 40) or Color3.fromRGB(60, 60, 65)
end)

-- Logic cho cÃ¡c nÃºt skill
local function SetupSkillToggle(button, skillKey)
    button.MouseButton1Click:Connect(function()
        CONFIG.SelectedSkills[skillKey] = not CONFIG.SelectedSkills[skillKey]
        button.Text = skillKey
        button.TextColor3 = CONFIG.SelectedSkills[skillKey] and Color3.fromRGB(80, 255, 80) or Color3.fromRGB(255, 80, 80)
        button.BackgroundColor3 = CONFIG.SelectedSkills[skillKey] and Color3.fromRGB(40, 100, 40) or Color3.fromRGB(60, 60, 65)
    end)
end

SetupSkillToggle(SkillR, "R")
SetupSkillToggle(SkillT, "T")
SetupSkillToggle(SkillF, "F")
SetupSkillToggle(SkillG, "G")

-- Cáº­p nháº­t tÃªn tÆ°á»›ng
CharacterInput.FocusLost:Connect(function()
    local newName = CharacterInput.Text:gsub("^%s*(.-)%s*$", "%1")
    
    if newName == "" then
        CharacterInput.Text = CONFIG.SkillSuffix
        return
    end
    
    if not newName:find("Kamen Rider") then
        CONFIG.SkillSuffix = newName
    else
        CONFIG.SkillSuffix = newName:gsub("Kamen Rider ", "")
    end
    
    CharacterInput.Text = CONFIG.SkillSuffix
    print("âœ… ÄÃ£ Ä‘á»•i tÆ°á»›ng thÃ nh: " .. CONFIG.SkillPrefix .. " " .. CONFIG.SkillSuffix)
end)

-- Cáº­p nháº­t Range
RangeInput.FocusLost:Connect(function()
    local newRange = tonumber(RangeInput.Text)
    if newRange and newRange > 0 then
        CONFIG.Range = newRange
        BubblePart.Size = Vector3.new(newRange * 2, newRange * 2, newRange * 2)
    else
        RangeInput.Text = tostring(CONFIG.Range)
    end
end)

-- Cáº­p nháº­t TP Delay
TPDelayInput.FocusLost:Connect(function()
    local newDelay = tonumber(TPDelayInput.Text)
    if newDelay and newDelay >= 0 then
        CONFIG.TeleportDelay = newDelay
    else
        TPDelayInput.Text = tostring(CONFIG.TeleportDelay)
    end
end)

-- Cáº­p nháº­t TP Cooldown
TPCooldownInput.FocusLost:Connect(function()
    local newCD = tonumber(TPCooldownInput.Text)
    if newCD and newCD >= 0 then
        CONFIG.TeleportCooldown = newCD
    else
        TPCooldownInput.Text = tostring(CONFIG.TeleportCooldown)
    end
end)

-- Cáº­p nháº­t Skill Delay
SkillDelayInput.FocusLost:Connect(function()
    local newDelay = tonumber(SkillDelayInput.Text)
    if newDelay and newDelay >= 0 then
        CONFIG.SkillDelay = newDelay
    else
        SkillDelayInput.Text = tostring(CONFIG.SkillDelay)
    end
end)

-- Cáº­p nháº­t Bubble Transparency
BubbleInput.FocusLost:Connect(function()
    local newTrans = tonumber(BubbleInput.Text)
    if newTrans and newTrans >= 0 and newTrans <= 1 then
        CONFIG.BubbleTransparency = newTrans
        if isAiming then
            BubblePart.Transparency = newTrans
        end
    else
        BubbleInput.Text = tostring(CONFIG.BubbleTransparency)
    end
end)

-- --- VÃ’NG Láº¶P CHÃNH ---
RunService.RenderStepped:Connect(function()
    local char = LocalPlayer.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then
        BubblePart.Position = Vector3.new(0, -1000, 0)
        return
    end
    
    BubblePart.Position = char.HumanoidRootPart.Position
    
    if teleportCooldownRemaining > 0 then
        teleportCooldownRemaining = math.max(0, teleportCooldownRemaining - RunService.RenderStepped:Wait())
        CooldownTimer.Text = string.format("%.1fs", teleportCooldownRemaining)
        if teleportCooldownRemaining <= 0 then
            CooldownFrame.Visible = false
        end
    end
    
    if isAiming then
        local target = GetClosestEnemy()
        if target and target:FindFirstChild("HumanoidRootPart") then
            local targetPos = target.HumanoidRootPart.Position
            local myPos = char.HumanoidRootPart.Position
            char.HumanoidRootPart.CFrame = CFrame.lookAt(myPos, Vector3.new(targetPos.X, myPos.Y, targetPos.Z))
        end
    end
end)
