-- Aim Assist Toggle Button GUI
local Players = game:GetService("Players")
local StarterGui = game:GetService("StarterGui")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Create ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AimAssistGui"
screenGui.Parent = playerGui
screenGui.ResetOnSpawn = false

-- Create Toggle Button
local toggleButton = Instance.new("TextButton")
toggleButton.Name = "AimAssistToggle"
toggleButton.Parent = screenGui
toggleButton.Size = UDim2.new(0, 120, 0, 40)
toggleButton.Position = UDim2.new(0, 10, 0, 10)
toggleButton.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
toggleButton.BorderSizePixel = 2
toggleButton.BorderColor3 = Color3.new(0.5, 0.5, 0.5)
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.Text = "Aim Assist: OFF"
toggleButton.TextColor3 = Color3.new(1, 1, 1)
toggleButton.TextSize = 14

-- Add corner rounding
local corner = Instance.new("UICorner")
corner.Parent = toggleButton
corner.CornerRadius = UDim.new(0, 8)

-- Create aim assist value to track state
local aimAssistEnabled = false

-- Toggle function
local function toggleAimAssist()
	aimAssistEnabled = not aimAssistEnabled
	if aimAssistEnabled then
		toggleButton.Text = "Aim Assist: ON"
		toggleButton.BackgroundColor3 = Color3.new(0.2, 0.6, 0.2)
	else
		toggleButton.Text = "Aim Assist: OFF"
		toggleButton.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
	end
end

-- Button click event
toggleButton.MouseButton1Click:Connect(toggleAimAssist)

-- Keyboard shortcut (optional - can be changed)
UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if gameProcessed then return end
	if input.KeyCode == Enum.KeyCode.F then
		toggleAimAssist()
	end
end)

-- Aim Assist Logic
local camera = workspace.CurrentCamera
local target = nil
local aimAssistStrength = 0.15 -- How strong the aim assist is (0.1 to 0.5 recommended)
local maxAimDistance = 200 -- Maximum distance to target

-- Function to find closest target
local function findClosestTarget()
	local closestTarget = nil
	local closestDistance = maxAimDistance
	local character = player.Character
	if not character or not character:FindFirstChild("HumanoidRootPart") then return nil end
	
	local hrp = character.HumanoidRootPart
	local lookVector = camera.CFrame.LookVector
	
	-- Check all characters in workspace
	for _, obj in workspace:GetDescendants() do
		if obj:IsA("Model") and obj ~= character then
			local humanoid = obj:FindFirstChildOfClass("Humanoid")
			local targetHrp = obj:FindFirstChild("HumanoidRootPart")
			
			if humanoid and targetHrp and humanoid.Health > 0 then
				-- Calculate distance to target
				local distance = (hrp.Position - targetHrp.Position).Magnitude
				
				if distance <= maxAimDistance then
					-- Check if target is in front of player (within 60 degree cone)
					local toTarget = (targetHrp.Position - hrp.Position).Unit
					local dotProduct = lookVector:Dot(toTarget)
					
					if dotProduct > 0.5 then -- 60 degree cone
						if distance < closestDistance then
							closestDistance = distance
							closestTarget = obj
						end
					end
				end
			end
		end
	end
	
	return closestTarget
end

-- Aim assist update function
local function updateAimAssist()
	if not aimAssistEnabled then return end
	
	local character = player.Character
	if not character or not character:FindFirstChild("HumanoidRootPart") then return end
	
	-- Find or update target
	if not target or not target:FindFirstChildOfClass("Humanoid") or target:FindFirstChildOfClass("Humanoid").Health <= 0 then
		target = findClosestTarget()
	end
	
	if target and target:FindFirstChild("HumanoidRootPart") then
		local targetHrp = target.HumanoidRootPart
		local currentCFrame = camera.CFrame
		
		-- Calculate target position (aim at head/torso area)
		local targetPosition = targetHrp.Position + Vector3.new(0, 2, 0) -- Aim slightly above center
		
		-- Calculate desired look direction
		local desiredLookDirection = (targetPosition - currentCFrame.Position).Unit
		
		-- Smoothly interpolate current look direction to desired direction
		local currentLookDirection = currentCFrame.LookVector
		local newLookDirection = currentLookDirection:Lerp(desiredLookDirection, aimAssistStrength)
		
		-- Update camera CFrame
		camera.CFrame = CFrame.new(currentCFrame.Position, currentCFrame.Position + newLookDirection)
	end
end

-- Connect to render stepped for smooth aim assist
RunService.RenderStepped:Connect(updateAimAssist)

-- Clean up target when it dies
workspace.DescendantRemoving:Connect(function(obj)
	if obj == target then
		target = nil
	end
end)
