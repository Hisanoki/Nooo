-- Aim Assist System with Toggle Button
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local StarterGui = game:GetService("StarterGui")

-- Configuration
local AIM_ASSIST_CONFIG = {
	enabled = false,
	maxDistance = 100,
	assistStrength = 0.3, -- 0.1 to 1.0, higher = stronger assist
	fieldOfView = 30, -- degrees
	targetPart = "HumanoidRootPart",
	teamCheck = true, -- false to target everyone
	showVisualIndicator = true,
	indicatorColor = Color3.new(1, 0, 0),
	indicatorSize = 0.5
}

-- Player and Camera
local player = Players.LocalPlayer
local camera = Workspace.CurrentCamera
local mouse = player:GetMouse()

-- UI Elements
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AimAssistGUI"
screenGui.Parent = StarterGui
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Toggle Button
local toggleButton = Instance.new("TextButton")
toggleButton.Name = "AimAssistToggle"
toggleButton.Parent = screenGui
toggleButton.Size = UDim2.new(0, 120, 0, 40)
toggleButton.Position = UDim2.new(0, 10, 0, 10)
toggleButton.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
toggleButton.BorderSizePixel = 2
toggleButton.BorderColor3 = Color3.new(0.5, 0.5, 0.5)
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.Text = "Aim Assist: OFF"
toggleButton.TextColor3 = Color3.new(1, 1, 1)
toggleButton.TextSize = 14

-- Visual Indicator (optional)
local indicator = Instance.new("Frame")
indicator.Name = "TargetIndicator"
indicator.Parent = screenGui
indicator.Size = UDim2.new(0, 20, 0, 20)
indicator.Position = UDim2.new(0.5, -10, 0.5, -10)
indicator.BackgroundColor3 = AIM_ASSIST_CONFIG.indicatorColor
indicator.BorderSizePixel = 0
indicator.BackgroundTransparency = 1
indicator.Visible = false

-- Make indicator circular
local corner = Instance.new("UICorner")
corner.Parent = indicator
corner.CornerRadius = UDim.new(0.5, 0)

-- Current target
local currentTarget = nil
local lastTargetTime = 0

-- Function to check if a character is valid target
local function isValidTarget(character)
	if not character or not character.Parent then return false end
	
	local humanoid = character:FindFirstChildOfClass("Humanoid")
	if not humanoid or humanoid.Health <= 0 then return false end
	
	local targetPlayer = Players:GetPlayerFromCharacter(character)
	if not targetPlayer then return false end
	
	-- Team check
	if AIM_ASSIST_CONFIG.teamCheck and targetPlayer.Team == player.Team then
		return false
	end
	
	-- Don't target self
	if targetPlayer == player then return false end
	
	return true
end

-- Function to find best target
local function findTarget()
	local bestTarget = nil
	local bestScore = math.huge
	local cameraPos = camera.CFrame.Position
	
	for _, targetPlayer in pairs(Players:GetPlayers()) do
		if targetPlayer ~= player then
			local character = targetPlayer.Character
			if isValidTarget(character) then
				local targetPart = character:FindFirstChild(AIM_ASSIST_CONFIG.targetPart)
				if targetPart then
					local distance = (targetPart.Position - cameraPos).Magnitude
					
					if distance <= AIM_ASSIST_CONFIG.maxDistance then
						-- Calculate angle from camera center
						local lookVector = camera.CFrame.LookVector
						local toTarget = (targetPart.Position - cameraPos).Unit
						local angle = math.deg(math.acos(lookVector:Dot(toTarget)))
						
						if angle <= AIM_ASSIST_CONFIG.fieldOfView then
							-- Score based on distance and angle (closer and more centered = better)
							local score = distance + angle * 2
							
							if score < bestScore then
								bestScore = score
								bestTarget = targetPart
							end
						end
					end
				end
			end
		end
	end
	
	return bestTarget
end

-- Function to apply aim assist
local function applyAimAssist(targetPosition)
	if not targetPosition then return end
	
	local currentLook = camera.CFrame.LookVector
	local toTarget = (targetPosition - camera.CFrame.Position).Unit
	
	-- Calculate the rotation needed
	local rotation = CFrame.new(Vector3.new(), currentLook:Cross(toTarget))
	local angle = math.acos(math.clamp(currentLook:Dot(toTarget), -1, 1))
	
	-- Apply smooth assist
	local assistAngle = angle * AIM_ASSIST_CONFIG.assistStrength
	local assistRotation = CFrame.Angles(0, 0, assistAngle)
	
	-- Update camera CFrame with assist
	local newCFrame = camera.CFrame:ToWorldSpace(assistRotation)
	camera.CFrame = CFrame.new(camera.CFrame.Position, camera.CFrame.Position + newCFrame.LookVector)
end

-- Toggle button functionality
local function toggleAimAssist()
	AIM_ASSIST_CONFIG.enabled = not AIM_ASSIST_CONFIG.enabled
	
	if AIM_ASSIST_CONFIG.enabled then
		toggleButton.BackgroundColor3 = Color3.new(0, 0.5, 0)
		toggleButton.Text = "Aim Assist: ON"
		indicator.Visible = AIM_ASSIST_CONFIG.showVisualIndicator
	else
		toggleButton.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
		toggleButton.Text = "Aim Assist: OFF"
		indicator.Visible = false
		currentTarget = nil
	end
end

-- Button click event
toggleButton.MouseButton1Click:Connect(toggleAimAssist)

-- Keyboard shortcut (optional)
UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if gameProcessed then return end
	
	if input.KeyCode == Enum.KeyCode.F1 then
		toggleAimAssist()
	end
end)

-- Main aim assist loop
RunService.RenderStepped:Connect(function(deltaTime)
	if not AIM_ASSIST_CONFIG.enabled then
		currentTarget = nil
		return
	end
	
	-- Find new target periodically
	local currentTime = tick()
	if currentTime - lastTargetTime > 0.1 then -- Check every 100ms
		currentTarget = findTarget()
		lastTargetTime = currentTime
	end
	
	-- Apply aim assist if we have a target
	if currentTarget and currentTarget.Parent then
		applyAimAssist(currentTarget.Position)
		
		-- Update visual indicator
		if AIM_ASSIST_CONFIG.showVisualIndicator then
			local screenPos = camera:WorldToScreenPoint(currentTarget.Position)
			if screenPos.Z > 0 then -- Target is in front of camera
				indicator.Position = UDim2.new(0, screenPos.X - 10, 0, screenPos.Y - 10)
				indicator.Visible = true
			else
				indicator.Visible = false
			end
		end
	else
		-- Lost target
		currentTarget = nil
		if AIM_ASSIST_CONFIG.showVisualIndicator then
			indicator.Visible = false
		end
	end
end)

-- Cleanup when player leaves
player.CharacterRemoving:Connect(function()
	if screenGui then
		screenGui:Destroy()
	end
end)

print("Aim Assist System Loaded! Press F1 or click the button to toggle.")
